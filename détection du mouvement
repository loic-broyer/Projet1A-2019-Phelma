import numpy as np
import matplotlib as plt
import cv2

print("ca a commencé")

def acquisition(chemin):
    img=cv2.imread(chemin,0)
    print('image lue2')
    print(img)
    longueur,largeur=img.shape
    return(img,longueur,largeur)

print("acquisition est passé")

def init_seuil(image1,image2,longueur,largeur):
    maxmoy=0
    maxim=0
    for long in range (longueur):
        for larg in range (largeur):
            if(254>(abs(image2[long][larg])-abs(image1[long][larg]))>maxim):
                maxim=abs(image2[long][larg])-abs(image1[long][larg])
        maxmoy+=(maxim/longueur)%1
    print(maxmoy)
    return(maxmoy)

print("init est passé")

def variations(image2,image1,longueur,largeur,seuil):
    #detecte les variations et pas les contours, sinon va détecter toutes les formes préentes sur le terrain
    variation=np.zeros((longueur,largeur))
    listevariation=[]
    for long in range (longueur):
        for larg in range (largeur):
            if(abs(image2[long][larg])-abs(image1[long][larg])<=seuil):
                variation[long][larg]=0
##                print(abs(image2[long][larg])-abs(image1[long][larg]))
            else:
##                print("c'est parti")
                variation[long][larg]=1
                listevariation.append([long,larg])
    return(variation,listevariation)

print("variations est passé")

image1,longueur1,largeur1=acquisition('IMG_20190128_102814.jpg')#ce devrait-être fait avec les premières captures avant le début du match pour s'adapter aux conditions du jour
image2,longueur2,largeur2=acquisition('IMG_20190128_102814_1.jpg')#idem
image3,longueur3,largeur3=acquisition('IMG_20190128_102815.jpg')#photo pour faire une tentative lecture d'image valide
image4,longueur4,largeur4=acquisition('IMG_20190128_102818.jpg')#idem
seuil=150
seuil=init_seuil(image1,image2,longueur1,largeur1)
print(seuil)
variation,listevariation=variations(image3,image4,longueur4,largeur4,seuil)
print(variation)
print(listevariation)
plt.Imshow(variation)
